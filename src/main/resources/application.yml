server:
  port: ${SERVER_PORT:8080}

spring:
  application:
    name: backend-service

  # MySQL DataSource
  datasource:
    url: jdbc:mysql://${DB_HOST:localhost}:${DB_PORT:3306}/${DB_NAME:backend_db}?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:root_password_secret_tcp}
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      idle-timeout: 300000
      connection-timeout: 20000

  # JPA/Hibernate
  jpa:
    hibernate:
      ddl-auto: none
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQLDialect
        format_sql: true

  # Redis
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      timeout: 5000ms
      password: ${REDIS_PASSWORD:}

  # Jackson
  jackson:
    serialization:
      write-dates-as-timestamps: false
    default-property-inclusion: non_null

  # Vault (disabled by default, enabled via dev/prod profiles)
  config:
    import: optional:vault://
  cloud:
    vault:
      enabled: false
      uri: ${VAULT_ADDR:http://localhost:8200}
      token: ${VAULT_TOKEN:}
      kv:
        enabled: true
        backend: secret
        default-context: backend-service
        profile-separator: /

# JWT Configuration
jwt:
  secret: ${JWT_SECRET:dmVyeS1pbXBvcnRhbnQtcGxlYXNlLWNoYW5nZS1pdC1pbi1wcm9kdWN0aW9uLXdpdGgtYXQtbGVhc3QtMjU2LWJpdHM=}
  access-token-expiration: ${JWT_ACCESS_TOKEN_EXPIRATION:3600000}
  refresh-token-expiration: ${JWT_REFRESH_TOKEN_EXPIRATION:604800000}

# MinIO Configuration
minio:
  endpoint: ${MINIO_ENDPOINT:http://localhost:9000}
  access-key: ${MINIO_ACCESS_KEY:admin}
  secret-key: ${MINIO_SECRET_KEY:123456789}
  bucket-name: ${MINIO_BUCKET:face-images}

# HTTP Client
http-client:
  connect-timeout: ${HTTP_CLIENT_CONNECT_TIMEOUT:30000}
  read-timeout: ${HTTP_CLIENT_READ_TIMEOUT:60000}
  write-timeout: ${HTTP_CLIENT_WRITE_TIMEOUT:60000}

# Face Recognition Service (Python)
face-recognition:
  service-url: ${FACE_SERVICE_URL:http://localhost:5000}

# Resilience4j Retry
resilience4j:
  retry:
    instances:
      externalService:
        max-attempts: 5
        wait-duration: 1s
        enable-exponential-backoff: true
        exponential-backoff-multiplier: 2.0
        retry-exceptions:
          - com.mario.backend.common.http.RetryableHttpException
        ignore-exceptions:
          - com.mario.backend.common.http.NonRetryableHttpException
          - com.mario.backend.common.exception.ApiException
